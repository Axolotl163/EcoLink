{% extends "layout.html" %} {% block styles %}
<link
	href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap"
	rel="stylesheet"
/>

<link
	href="https://fonts.googleapis.com/css2?family=Bungee&display=swap"
	rel="stylesheet"
/>

<style>
	body {
		overflow-x: hidden;
    }
    
	.title {
		font-family: "Bungee";
		text-align: center;
		background-color: green;
		color: white;
		margin: 0 -9999rem;
	}
	.trending {
		margin-top: 3%;
		color: white;
		font-family: "Bungee";
	}
	.trending-logo {
		text-align: center;
		margin-top: 5%;
	}
	.subcontainer {
		margin-top: 4%;
		text-align: center;
	}
	.feed {
		color: white;
		font-family: "Bungee";
	}
	.card-link {
		color: #b7deb2;
	}
	.card-link:hover {
		color: purple;
    }
    .you {
        color: white;
		font-family: "Bungee";
    }
</style>
{% endblock %} {% block content %}
<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

		<script>
			function handler(id){
				$.post("/api/likePost",{"postid":id},function(data){
					document.getElementById(id).disabled = true;
					if (data == "success"){
						alert("Liked post!")
					}
					else{
						alert("Already liked post!")
					}
				})
			}

			var posts = [];
			$.get("/api/followingPosts",function(data){
				data = JSON.parse(data);
				for(var i in data){
					data[i]["id"] = i
					posts.push(data[i])
				}
				posts.sort((a,b) => {
					if (a.timestamp < b.timestamp){
						return 1;
					}
					if (a.timestamp > b.timestamp){
						return -1
					}
					return 0;
				})
				jar = document.cookie.split("; ")
				// just in case
				var uid = "";
				for(var i in jar){
					if (jar[i].indexOf("uid")!=-1){
						uid = jar[i].substring(4)
						break;
					}
				}
				console.log(uid);
				for(var i in posts){
					var x = posts[i]
					var disabled=""
					if (x["likes"].find(x => x == uid)){
						disabled = "disabled"
					}
					var template = `<div class="card">
							<div class="card-body">
								
								<img
                                    src=${x.image}
                                    class="card-img-top"
                                    width="100%"
                                    height="auto"
                                    alt="Card image cap"
								/>
								<h5 class="card-title">${x.title}</h5>
								<p class="card-text">
									${x.description}
                                </p>
                                <ul class="list-group list-group-flush">
									<a href="/map?location=${x.location}" class="list-group-item">${x.location}</a>
                                    <li class="list-group-item">Recent Likers</li>
                                  </ul>
                                <a href="#!" class="card-link">${x.name}</a>
								<a href="#!" class="card-link">Likes</a>
								</br>
								</br>
								<button id="${x.id}" type="button" ${disabled} onclick="handler('${x.id}')" class="btn btn-danger">Like</button>
							</div>
						</div>
						</br>`
					document.getElementById("feed_main").innerHTML += template;
				}
			})
		</script>
	</head>
	<body>
		<h1 class="title">ECOLINK</h1>
		<div class="container">
			<div class="subcontainer">
				<div class="row">
					<div class="col-sm-3">
						<!-- <img
							class="trending-logo"
							src="../static/plant.png"
							height="auto"
							width="50%"
						/> -->
						<h2 class="trending">Trending</h2>
					</div>
					<div class="col-sm-6" id = "feed_main">
                        <h2 class="feed">Feed</h2>
                        
					</div>
					<div class="col-sm-3">
						<h2 class="you">Profile</h2>
						<div class="card">
							<div class="card-body">
								<img
                                    src="https://image.shutterstock.com/image-vector/default-avatar-profile-icon-grey-260nw-518740741.jpg"
                                    width="80%"
                                    height="auto"
								/>
								<h6 class="card-subtitle mb-4 text-muted">
									{{name}}
								</h6>
								<p class="card-text">
									{{bio}}
								</p>
								<a href="#!" class="card-link">Profile Page</a>
								<a href="#!" class="card-link">Followers</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>


</html>

{% endblock %}
{% block scripts %}
<script>
	console.log(posts)
	for(var i in posts){
		var x = posts[i]
		console.log(x.id)
	}
</script>
{% endblock %}
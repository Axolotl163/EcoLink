{% extends "layout.html" %} {% block styles %}
<link
	href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap"
	rel="stylesheet"
/>

<link
	href="https://fonts.googleapis.com/css2?family=Bungee&display=swap"
	rel="stylesheet"
/>

<style>
	body {
		overflow-x: hidden;
		background-color: #ebf3fa;
    }
    
	.title {
		font-family: "Bungee";
		text-align: center;
		
		color: white;
		margin: 0 -9999rem;
	}

	h2 .header-text {
		font-family: "Josefin Sans";
		text-align: center;
		color: white;
	}
	
	.trending-logo {
		text-align: center;
		margin-top: 5%;
	}
	.subcontainer {
		margin-top: 4%;
		text-align: center;
	}
	.card-link {
		color: #b7deb2;
	}
	.card-link:hover {
		color: purple;
    }
    .you, .trending, .feed {
		color:#b7deb2;
		text-shadow:1px solid black;
		font-family: "Bungee";
		-webkit-text-stroke: 1px lightslategrey;
    	-webkit-text-fill-color:#b7deb2;
	}
	.z-depth-5 {
		
		box-shadow: 0 3px 3px 0 rgba(0, 0, 0, 0.14), 0 1px 7px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -1px rgba(0, 0, 0, 0.2);
		padding:5px;
		
		background-color:whitesmoke;
	}
	#logout{
		transition:0.4s ease;
	}
	#logout:hover{
		background-color:red;
	}

	a {
		font-family: "Josefin Sans", sans-serif;
		color: white;
		text-decoration: underline;
		font-size:32px;
	}
	nav{
		width:100vw;
		margin-left:0px;
		margin:0px;
		padding:0px;
		height:150px;
		display:block;
		background-color: rgba(0,255,0,0.3);
	}
	.col-2dot4,
	.col-sm-2dot4 {
		position: relative;
		width: 100%;
		min-height: 1px;
		padding-right: 15px;
		padding-left: 15px;
	}
@media (min-width: 540px) {
    .col-sm-2dot4 {
        -webkit-box-flex: 0;
        -ms-flex: 0 0 20%;
        flex: 0 0 20%;
        max-width: 20%;
	}
	.col-sm-2dot4 > a {
		margin-top:100px;
	}
} 
@media (max-width: 540px) {
    .col-sm-2dot4 > a {
        display:none;
    }
} 

</style>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet"/>
{% endblock %} {% block content %}
<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

		<script>
			function handler(id){
				$.post("/api/likePost",{"postid":id},function(data){
					document.getElementById(id).disabled = true;
					if (data == "success"){
						alert("Liked post!")
					}
					else{
						alert("Already liked post!")
					}
				})
			}

			var posts = [];
			$.get("/api/followingPosts",function(data){
				data = JSON.parse(data);
				for(var i in data){
					data[i]["id"] = i
					posts.push(data[i])
				}
				posts.sort((a,b) => {
					if (a.timestamp < b.timestamp){
						return 1;
					}
					if (a.timestamp > b.timestamp){
						return -1
					}
					return 0;
				})
				jar = document.cookie.split("; ")
				// just in case
				var uid = "";
				for(var i in jar){
					if (jar[i].indexOf("uid")!=-1){
						uid = jar[i].substring(4)
						break;
					}
				}
				console.log(uid);
				for(var i in posts){
					var x = posts[i]
					var disabled=""
					if (x["likes"].find(x => x == uid)){
						disabled = "disabled"
					}
					var template = `<div class="card">
							<div class="card-body">
								
								<img
                                    src=${x.image}
                                    class="card-img-top"
                                    width="100%"
                                    height="auto"
                                    alt="Card image cap"
								/>
								<h5 class="card-title">${x.title}</h5>
								<p class="card-text">
									${x.description}
                                </p>
                                <ul class="list-group list-group-flush">
									<a href="/map?location=${x.location}" class="list-group-item">${x.location}</a>
                                    <li class="list-group-item">Recent Likers</li>
                                  </ul>
                                <a href="#!" class="card-link">${x.name}</a>
								<a href="#!" class="card-link">Likes</a>
								</br>
								</br>
								<button id="${x.id}" type="button" ${disabled} onclick="handler('${x.id}')" class="btn btn-danger">Like</button>
							</div>
						</div>
						</br>`
					document.getElementById("feed_main").innerHTML += template;
				}
			})
		</script>
	</head>
	
		<nav>
			<div class="row">
				<div class="col-sm-2dot4" style="text-align:center;background-color:pink;">
					<a href="/logout">Logout</a>
				</div>
				<div class="col-sm-2dot4" style="text-align:center;background-color:teal;">
					<a href="/logout">Logout</a>
				</div>
				<div class="col-sm-2dot4">
					<h1 class="title">ECOLINK</h1>
				</div>
				<div class="col-sm-2dot4" style="text-align:center;background-color:pink;">
					<a href="/logout">Logout</a>
				</div>
				<div class="col-sm-2dot4" style="text-align:center;background-color:teal;">
					<a href="/logout">Logout</a>
				</div>
			</div>
		</nav>


		<nav>
			<div class="row">
				<div class="col-sm-4 dot4" style="text-align:center;">
					<h2 class="header-text"><a href="/post">Post</a></h2>
				</div>
				<div class="col-sm-4 dot4">
					<h1 class="title">ECOLINK</h1>
				</div>
				<div class="col-sm-4 dot4" style="text-align:center;">
					<h2 class="header-text"><a href="/profile">Profile</a></h2>
				</div>
			</div>
		</nav>
		
		<div class="container">
			<div class="subcontainer">
				<div class="row">
					<div class="col-sm-3 z-depth-5">
						<!-- <img
							class="trending-logo"
							src="../static/plant.png"
							height="auto"
							width="50%"
						/> -->
						<h2 class="trending">Trending</h2>
					</div>
					<div class="col-sm-6 z-depth-5" id = "feed_main">
                        <h2 class="feed">Feed</h2>
                        
					</div>
					<div class="col-sm-3 z-depth-5">
						<h2 class="you">Profile</h2>
						<div class="card">
							<div class="card-body">
								<img
                                    src="{{avatar}}"
                                    width="80%"
									height="auto"
									style="border-radius:50%;"
								/>

								<h6 class="card-subtitle mb-4 text-muted" style="margin-top:1rem;font-size:22px;">
									{{ name }}
								</h6>
								<p class="card-text">
									{{ bio }}

								</p>
								<a href="#!" class="card-link">Profile Page</a>
								<a href="#!" class="card-link">Followers</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>


</html>

{% endblock %}
{% block scripts %}
<script>
	console.log(posts)
	for(var i in posts){
		var x = posts[i]
		console.log(x.id)
	}
</script>
{% endblock %}